<source>
  type forward
  port 24224
</source>

<match debug.**>
  type stdout
</match>

<match personal_cloud.**>
  type copy
  <store>
    type file
    path /var/log/fluent/personal_cloud
    compress gz
  </store>
  <store>
    type rewrite_tag_filter
    rewriterule1 level (FATAL|ERROR) warning.personal_cloud
    rewriterule2 content .*Redis::TimeoutError.* warning.redis_timeout_error
  </store>
</match>

<match warning.personal_cloud>
  type hipchatv2
  api_token RfDbhf7QXLkXMu8yMCi0ijQv1HIVGFimHw7Q4QZd
  default_room PersonalCloud-Logging
  default_from Error
  default_color red
  default_notify true
  default_format text
  default_timeout 100
  default_mention all
</match>

<match waring.redis_timeout_error>
  type copy
  <store>
    type hipchatv2
    api_token RfDbhf7QXLkXMu8yMCi0ijQv1HIVGFimHw7Q4QZd
    default_room PersonalCloud-Logging
    default_from Error
    default_color red
    default_notify true
    default_format text
    default_timeout 100
    default_mention all
  </store>
  <store>
    type mail
    host email-smtp.us-east-1.amazonaws.com
    port 587
    user AKIAJPGIHH7QJI23OHDA
    password 'Al3nfM1pL71gHLNWhhas4avVrsgc34jRYh7WNLH6Qd/M'
    enable_starttls_auto true
    from do-not-reply@pcloud.ecoworkinc.com
    to hiroshiyui@ecoworkinc.com
    subject '[Personal Cloud] -=FATAL=- Redis::TimeoutError'
    message '%s\n%s\n%s'
    message_out_keys target_key,pattern,value
  </store>
</match>

## match fluent's internal events
<match fluent.**>
  type null
</match>

## match not matched logs and write to file
<match **>
  type file
  path /var/log/fluent/log
  compress gz
</match>
