<source>
  type forward
  port 24224
</source>

<match debug.**>
  type stdout
</match>

<match personal_cloud.**>
  type copy
  <store>
    type file
    path /var/log/fluent/personal_cloud
    compress gz
  </store>
  <store>
    type rewrite_tag_filter
    rewriterule1 content .*Redis::TimeoutError.* warning.redis_timeout_error
    rewriterule2 level (FATAL|ERROR) hipchat.__TAG__
  </store>
</match>

<match hipchat.**>
  type copy
  <store>
    type file
    remove_tag_prefix hipchat
    path /var/log/fluent/hipchat
    compress gz
  </store>
  <store>
    type hipchatv2
    remove_tag_prefix hipchat
    api_token RfDbhf7QXLkXMu8yMCi0ijQv1HIVGFimHw7Q4QZd
    default_room PersonalCloud-Logging
    default_from Error
    default_color red
    default_notify true
    default_format text
    default_timeout 100
    default_mention all
  </store>
</match>

<match warning.redis_timeout_error>
  type copy
  <store>
    type hipchatv2
    api_token RfDbhf7QXLkXMu8yMCi0ijQv1HIVGFimHw7Q4QZd
    default_room PersonalCloud-Logging
    default_from Error
    default_color red
    default_notify true
    default_format text
    default_timeout 100
    default_mention all
  </store>
  <store>
    type mail
    host email-smtp.us-east-1.amazonaws.com
    port 587
    user AKIAJPGIHH7QJI23OHDA
    password 'Al3nfM1pL71gHLNWhhas4avVrsgc34jRYh7WNLH6Qd/M'
    enable_starttls_auto true
    from info@myzyxel.com
    to pcloud-notify@ecoworkinc.com,pcloud-zyxel-notify@ecoworkinc.com
    subject '[Personal Cloud] -=FATAL=- Redis::TimeoutError'
    message '[%s] %s@%s <- %s\n%s'
    message_out_keys level,host,environment,ip,content
  </store>
</match>

## match fluent's internal events
<match fluent.**>
  type null
</match>

## match not matched logs and write to file
<match **>
  type file
  path /var/log/fluent/log
  compress gz
</match>

<match skip>
  type null
</match>
