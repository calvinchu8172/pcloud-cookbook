<source>
  type tail
  tag personal_cloud_portal.unicorn.stderr
  path /srv/www/personal_cloud_portal/shared/log/unicorn.stderr.log 
  pos_file /var/log/fluent/unicorn.stderr.log.pos
  format /^[A-Z],\s\[(?<time>.*)\s#[0-9].*\]\s\s(?<level>[A-Z].*)\s--\s:\s(?<record>.*)$/
  refresh_interval 30
</source>

<source>
  type tail
  tag personal_cloud_portal.unicorn.stdout
  path /srv/www/personal_cloud_portal/shared/log/unicorn.stdout.log
  pos_file /var/log/fluent/unicorn.stdout.log.pos
  format /^[A-Z],\s\[(?<time>.*)\s#[0-9].*\]\s\s(?<level>[A-Z].*)\s--\s:\s(?<record>.*)$/
  refresh_interval 30
</source>

<source>
  type tail
  tag personal_cloud_portal.app
  path /srv/www/personal_cloud_portal/shared/log/app.log
  pos_file /var/log/fluent/app.log.pos
  format /^(?<time>.*)\s--\s(?<record>.*)$/
  refresh_interval 5
</source>

<source>
  type tail
  tag personal_cloud_portal.db
  path /srv/www/personal_cloud_portal/shared/log/db.log
  pos_file /var/log/fluent/db.log.pos
  format /^(?<time>.*)\s--\s(?<record>.*)$/
  refresh_interval 5
</source>

<match personal_cloud_portal.**>
  type copy
  <store>
    type file
    path /var/log/fluent/personal_cloud_portal
    compress gz
  </store>
  <store>
    type forward
    <server>
      name fluentd1
      host 10.107.10.174
      port 24224
      weight 60
    </server>
    <server>
      name fluentd2
      host 10.107.10.126
      port 24224
      weight 60
      standby
    </server>
  </store>
</match>

## match not matched logs and write to file
<match **>
  type file
  path /var/log/fluent/log
  compress gz
</match>
